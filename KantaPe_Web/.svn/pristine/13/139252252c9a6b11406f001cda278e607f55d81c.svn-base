//Atributos
var urlPrincipal = 'Cancion.aspx';
var urlEdicion = 'RegistroCancion.aspx';

$(function () {
    CargarInicial();
    CargarControles();
    ObtenerCancion();
});

function CargarInicial() {

    jQuery.validator.addMethod('selectGenero', function (value) {
        return (value != null);
    }, "Seleccione el género");

    jQuery.validator.addMethod('selectIdioma', function (value) {
        return (value != null);
    }, "Seleccione el idioma");

    jQuery.validator.addMethod('selectArtista', function (value) {
        return (value != null);
    }, "Seleccione el artista");

    jQuery.validator.addMethod('selectCancion', function (value) {
        return (value != null);
    }, "Seleccione la cancion");

    jQuery.validator.addMethod('selectEstado', function (value) {
        return (value != '');
    }, "Seleccione el estado");

    jQuery.validator.addMethod('CancionSimple', function (value) {
        if ($("#txtDescripcionCancion").is(":disabled"))
            return true;
        else if (value != "")
            return true;
    }, "Ingrese la canción");
    jQuery.validator.addMethod('Genero', function (value) {
        if ($("#txtDescripcionGenero").is(":disabled"))
            return true;
        else if (value != "")
            return true;
    }, "Ingrese el genero");
    jQuery.validator.addMethod('Idioma', function (value) {
        if ($("#txtDescripcionIdioma").is(":disabled"))
            return true;
        else if (value != "")
            return true;
    }, "Ingrese el idioma");
    jQuery.validator.addMethod('Artista', function (value) {
        if ($("#txtDescripcionArtista").is(":disabled"))
            return true;
        else if (value != "")
            return true;
    }, "Ingrese el artista");
    jQuery.validator.addMethod('Album', function (value) {
        if ($("#txtDescripcionAlbum").is(":disabled"))
            return true;
        else if (value != "")
            return true;
    }, "Ingrese el album");
    jQuery.validator.addMethod('SelectAlbumModal', function (value) {
        return (value != null);
    }, "Seleccione un artista");

    var settings = $('#frmContent').validate().settings;
    $.extend(settings, {
        highlight: function (element) {
            $(element).closest('.form-group').removeClass('has-success').addClass('has-error');
        },
        success: function (element) {
            $(element).closest('.form-group').removeClass('has-error').addClass('has-success');
        }
    });
}

function CargarControles() {

    //controles
    $("#fileUpload").fileserver(
    {
        idAlmacen: $("#hdIdAlmacen").val(),
        idRegistro: -1,
        autoUpload: true,
        replace: true,
        successMessage: false,
        success: function (obj_pResultado) {
            $("#lnkEliminarFoto").css('display', '');
            $("#hdIdDocumento").val(obj_pResultado.ReturnId);
            VerArchivoElemento('imgAlbumImagen', $("#hdIdAlmacen").val(), -1, obj_pResultado.ReturnId);
        }
    });

    $(".btnGrabar").click(function () {
        return GuardarCancion();
    });

    $(".btnCancelar").click(function () {
        ConfirmJQ('¿Está seguro de regresar a la ventana anterior?', function () { document.location.href = urlPrincipal });
        return false;
    });

    //Eliminar Foto
    $("#lnkEliminarFoto").click(function () { ConfirmJQ('¿Está seguro de eliminar la foto?', EliminarFoto); });
    $("#lnkEliminarFoto").css('display', 'none');

    //Busqueda Album    
    $("#btnAlbum_find").click(function () {
        var obj_modal = $("#mdBuscadorAlbum").modal('show', {
            backdrop: true,
            keyboard: false,
        });

        $('#mdBuscadorAlbum').on('shown.bs.modal', function () {
            $("#txtNombreBuscadorAlbum").focus();
        });

        ListarBusquedaAlbum(1);
    });

    $("#btnAlbum_remove").click(function () {
        $("#hdIdArtista").val('');
        $("#hdIdAlbum").val('');
        $("#txtAlbum_input").val('');
    });

    $("#mdBuscadorAlbum").find('.modal-footer .btn-aceptar').click(function () {
        var obj_Registro = ObtenerRegistroBuscadorAlbum();
        if (obj_Registro != null) {
            $("#hdIdArtista").val(obj_Registro.idArtista);
            $("#hdIdAlbum").val(obj_Registro.idAlbum);
            $("#txtAlbum_input").val(obj_Registro.artistaAlbum);
            $("#mdBuscadorAlbum").modal('hide');
        }
    });

    $("#mdBuscadorAlbum").find('.modal-footer .btn-cancelar').click(function () {
        $("#mdBuscadorAlbum").modal('hide');
    });
    //fin BuscadorAlbum

    $("#txtTitulo").focus();

    $('#ddlEmpresa').change(function () {
        CargarLocal(true, null);
    });

    //---------------CANCIÓN-------------------
    $("#btnCancion_add").click(function () {
        $("#txtDescripcionCancion").val('');
        var obj_modal = $("#mdCancion").modal('show', {
            backdrop: true,
            keyboard: false,
        });
        $('#mdCancion').on('shown.bs.modal', function () {
            $("#txtDescripcionCancion").focus();
        });
        return false;
    });

    $("#mdCancion").find('.modal-footer .btn-aceptar').click(function () {
        GuardarCancionSimple();
    });

    $("#mdCancion").find('.modal-footer .btn-cancelar').click(function () {
        $("#mdCancion").modal('hide');
    });
    //------------Genero--------------
    $("#btnGenero_add").click(function () {
        $("#txtDescripcionGenero").val('');
        var obj_modal = $("#mdGenero").modal('show', {
            backdrop: true,
            keyboard: false,
        });
        $('#mdGenero').on('shown.bs.modal', function () {
            $("#txtDescripcionGenero").focus();
        });
        return false;
    });

    $("#mdGenero").find('.modal-footer .btn-aceptar').click(function () {
        GuardarGenero();
    });

    $("#mdGenero").find('.modal-footer .btn-cancelar').click(function () {
        $("#mdGenero").modal('hide');
    });

    //---------------IDIOMA-------------------
    $("#btnIdioma_add").click(function () {
        $("#txtDescripcionIdioma").val('');
        var obj_modal = $("#mdIdioma").modal('show', {
            backdrop: true,
            keyboard: false,
        });
        $('#mdIdioma').on('shown.bs.modal', function () {
            $("#txtDescripcionIdioma").focus();
        });
        return false;
    });

    $("#mdIdioma").find('.modal-footer .btn-aceptar').click(function () {
        GuardarIdioma();
    });

    $("#mdIdioma").find('.modal-footer .btn-cancelar').click(function () {
        $("#mdIdioma").modal('hide');
    });

    //---------------ARTISTA-------------------
    $("#btnArtista_add").click(function () {
        $("#txtDescripcionArtista").val('');
        var obj_modal = $("#mdArtista").modal('show', {
            backdrop: true,
            keyboard: false,
        });
        $('#mdArtista').on('shown.bs.modal', function () {
            $("#txtDescripcionArtista").focus();
        });
        return false;
    });

    $("#mdArtista").find('.modal-footer .btn-aceptar').click(function () {
        GuardarArtista();
    });

    $("#mdArtista").find('.modal-footer .btn-cancelar').click(function () {
        $("#mdArtista").modal('hide');
    });

    //---------------ALBUM-------------------
    $("#btnAlbum_add").click(function () {
        $("#txtDescripcionAlbum").val('');
        var obj_modal = $("#mdAlbum").modal('show', {
            backdrop: true,
            keyboard: false,
        });
        $('#mdAlbum').on('shown.bs.modal', function () {
            $("#txtDescripcionAlbum").focus();
        });
        return false;
    });

    $("#mdAlbum").find('.modal-footer .btn-aceptar').click(function () {
        GuardarAlbum();
    });

    $("#mdAlbum").find('.modal-footer .btn-cancelar').click(function () {
        $("#mdAlbum").modal('hide');
    });

    InicializarCancionBuscador(null);
    InicializarGeneroBuscador(null);
    InicializarIdiomaBuscador(null);
    InicializarArtistaBuscador(null);
    InicializarAlbumBuscador(null);
    InicializarArtistaAlbumBuscador(null);
}

function ValidacionCancion() {
    var settings = $('#frmContent').validate().settings;
    $('.form-group').removeClass('has-error').removeClass('has-success');
    $.extend(settings, {
        ignore: "",
        rules: {
            ddlCancion: { selectCancion: true },
            ddlGenero: { selectGenero: true },
            ddlIdioma: { selectIdioma: true },
            ddlArtista: { selectArtista: true },

            //ctl00$cphBody$txtDecada: { required: false, },
            //ctl00$cphBody$txtVersion: { required: false, },
            //ctl00$cphBody$txtNombreArchivo: { required: false, },
            //ctl00$cphBody$txtAnio: { required: false, },
            //ctl00$cphBody$txtLetra: { required: false, },
            //ctl00$cphBody$txtDuracion: { required: false, },
            //ctl00$cphBody$txtYoutube: { required: false, },
            ctl00$cphBody$ddlEstado: { selectEstado: true }
        },
        messages: {
            ctl00$cphBody$txtTitulo: { required: 'Ingrese el titulo' },
            //ctl00$cphBody$txtDecada: { required: 'Ingrese la decada' },
            //ctl00$cphBody$txtVersion: { required: 'Ingrese la versión' },
            //ctl00$cphBody$txtNombreArchivo: { required: 'Ingrese el nombre del archivo' },
            //ctl00$cphBody$txtAnio: { required: 'Ingrese el año' },
            //ctl00$cphBody$txtLetra: { required: 'Ingrese la letra' },
            //ctl00$cphBody$txtDuracion: { required: 'Ingrese la duración' },
            //ctl00$cphBody$txtYoutube: { required: 'Ingrese el enlace' },
        },
    });
}


function GuardarCancion() {

    $("#txtAlbum_input").prop('readonly', false);
    ValidacionCancion();
    var blnValid = $('#frmContent').valid();
    $("#txtAlbum_input").prop('readonly', true);


    if ($('#frmContent').valid()) {

        obj_Cancion = new Object();
        IdLocalCancion = null;
        if ($("#hdIdCancion").val() != '')
            IdLocalCancion = $("#hdIdCancion").val();

        obj_Cancion.IdCancion = $("#ddlCancion").val();
        obj_Cancion.IdArtista = $("#ddlArtista").val();
        obj_Cancion.IdAlbum = $("#ddlAlbum").val();
        obj_Cancion.IdGenero = $("#ddlGenero").val();
        obj_Cancion.IdIdioma = $("#ddlIdioma").val();
        obj_Cancion.IdEmpresa = $("#ddlEmpresa").val();
        obj_Cancion.IdLocal = $("#ddlLocal").val();


        obj_Cancion.Decada = null;
        if ($("#txtDecada").val() != '')
            obj_Cancion.Decada = $("#txtDecada").val();

        obj_Cancion.Version = null;
        if ($("#txtVersion").val() != '')
            obj_Cancion.Version = $("#txtVersion").val();

        obj_Cancion.NombreArchivo = null;
        if ($("#txtNombreArchivo").val() != '')
            obj_Cancion.NombreArchivo = $("#txtNombreArchivo").val();

        obj_Cancion.Anio = null;
        if ($("#txtAnio").val() != '')
            obj_Cancion.Anio = $("#txtAnio").val();

        obj_Cancion.Letra = null;
        if ($("#txtLetra").val() != '')
            obj_Cancion.Letra = $("#txtLetra").val();

        obj_Cancion.Duracion = null;
        if ($("#txtDuracion").val() != '')
            obj_Cancion.Duracion = $("#txtDuracion").val();

        obj_Cancion.Youtube = null;
        if ($("#txtYoutube").val() != '')
            obj_Cancion.Youtube = $("#txtYoutube").val();

        //obj_Cancion.IdCancionSolicitud = $("#hdIdCancionSolicitud").val();
        obj_Cancion.Estado = $("#ddlEstado").val();

        //Eliminacion de la imagen
        var str_Ruta = $('#hdAlbumImagen').val();
        if (str_Ruta == $("#imgAlbumImagen").attr('src')) {
            obj_Cancion.Foto = new Object();
            obj_Cancion.Foto.IdAlmacen = $("#hdIdAlmacen").val();
            obj_Cancion.Foto.IdRegistro = -1;
            obj_Cancion.Foto.IdDocumento = null;
        }

        //Anexar Imagen
        if ($("#hdIdDocumento").val() != '') {
            obj_Cancion.Foto = new Object();
            obj_Cancion.Foto.IdAlmacen = $("#hdIdAlmacen").val();
            obj_Cancion.Foto.IdRegistro = -1;
            obj_Cancion.Foto.IdDocumento = $("#hdIdDocumento").val();
        }

        Accion('RegistroCancion.aspx/GuardarCancion', { "str_pCancion": JSON.stringify(obj_Cancion), "int_pIdLocalCancion": IdLocalCancion },
            function () { document.location.href = urlPrincipal; });
    }
    return false;
}

function ObtenerCancion() {
    var int_IdCancion = $("#hdIdCancion").val();
    if (int_IdCancion != '') {
        var obj_Cancion = ObtenerData("RegistroCancion.aspx/ObtenerCancion", { "int_pIdCancion": int_IdCancion });
        if (obj_Cancion != null) {

            var lst_Artista = [];
            var obj_Artista = new Object();
            obj_Artista.id = obj_Cancion.IdArtista;
            obj_Artista.descripcion = obj_Cancion.Artista.Nombre;
            lst_Artista.push(obj_Artista);
            InicializarArtistaBuscador(lst_Artista);

            var lst_Genero = [];
            var obj_Genero = new Object();
            obj_Genero.id = obj_Cancion.IdGenero;
            obj_Genero.descripcion = obj_Cancion.Genero.Descripcion;
            lst_Genero.push(obj_Genero);
            InicializarGeneroBuscador(lst_Genero);

            var lst_Idioma = [];
            var obj_Idioma = new Object();
            obj_Idioma.id = obj_Cancion.IdIdioma;
            obj_Idioma.descripcion = obj_Cancion.Idioma.Descripcion;
            lst_Idioma.push(obj_Idioma);
            InicializarIdiomaBuscador(lst_Idioma);

            var lst_Cancion = [];
            var obj_CancionSimple = new Object();
            obj_CancionSimple.id = obj_Cancion.IdCancion;
            obj_CancionSimple.descripcion = obj_Cancion.Cancion.Descripcion;
            lst_Cancion.push(obj_CancionSimple);
            InicializarCancionBuscador(lst_Cancion);

            $("#ddlArtista").val(obj_Cancion.IdArtista)
            var lst_Album = [];
            var obj_Album = new Object();
            obj_Album.id = obj_Cancion.IdAlbum;
            obj_Album.descripcion = obj_Cancion.Album.Titulo;
            lst_Album.push(obj_Album);
            InicializarAlbumBuscador(lst_Album);
            //$("#ddlCancion").val(obj_Cancion.Cancion.Descripcion);
            //$("#ddlArtista").val(obj_Cancion.Artista.Descripcion);
            //$("#ddlAlbum").val(obj_Cancion.IdAlbum);
            //$("#txtAlbum_input").val(obj_Cancion.Artista.Nombre + " - " + obj_Cancion.Album.Titulo);
            //$("#ddlGenero").val(obj_Cancion.IdGenero);
            $("#ddlIdioma").val(obj_Cancion.IdIdioma);
            $("#txtDecada").val(obj_Cancion.Decada);
            $("#txtVersion").val(obj_Cancion.Version);
            $("#txtNombreArchivo").val(obj_Cancion.NombreArchivo);
            $("#txtAnio").val(obj_Cancion.Anio);
            $("#txtLetra").val(obj_Cancion.Letra);
            $("#txtDuracion").val(obj_Cancion.Duracion);
            $("#txtYoutube").val(obj_Cancion.Youtube);
            $("#hdIdCancionSolicitud").val(obj_Cancion.IdCancionSolicitud);
            //$("#txtCancionSolicitud").val(obj_Cancion.CancionSolicitud.Descripcion);
            $("#ddlEstado").val(obj_Cancion.Estado);
            //$("#ddlEmpresa").val(obj_Cancion.IdEmpresa);
            //$("#ddlLocal").val(obj_Cancion.IdLocal);

            //Auditoria
            $("#ddUsuarioCreacion").html(obj_Cancion.UsuarioCreacion);
            $("#ddUsuarioModificacion").html(obj_Cancion.UsuarioModificacion);
            $("#ddFechaCreacion").html(ToDateTimeString(obj_Cancion.FechaCreacion));
            $("#ddFechaModificacion").html(ToDateTimeString(obj_Cancion.FechaModificacion));

            
        }
    }
}
function EliminarFoto() {
    $("#hdIdDocumento").val('');
    var str_Ruta = $('#hdAlbumImagen').val();
    $("#imgAlbumImagen").attr('src', str_Ruta);
    $("#lnkEliminarFoto").css('display', 'none');
}

function CargarLocal(bln_pAsync, int_pIdDireccion) {

    var ddlLocal = $("#ddlLocal");
    ddlLocal.empty();
    ddlLocal.html('');
    ddlLocal.append($("<option value=''>--Seleccione--</option>"));

    var int_IdPersona = $("#ddlEmpresa").val();
    if (int_IdPersona != '') {
        var obj_Data = { "int_pIdPersona": int_IdPersona };
        AccionDefault(bln_pAsync, "RegistroCancion.aspx/ListarLocal", obj_Data,
             function (obj_pLista) {
                 //ddlNivel.prop("disabled", false);
                 var str_Selected = '';
                 for (var i = 0; i < obj_pLista.Result.length; i++) {
                     if (int_pIdDireccion != null)
                         str_Selected = (obj_pLista.Result[i].IdDireccion == IdDireccion) ? 'selected' : '';
                     ddlLocal.append($("<option value='" + obj_pLista.Result[i].IdDireccion + "' " + str_Selected + ">" + obj_pLista.Result[i].Direccion + "</option>"));
                 }
                 // ddlLocal.prop("disabled", true);
             }, null, null, null, 1);
    }
}

//-----------------------------AUTOCOMPLETAR-----------------------------

function InicializarCancionBuscador(obj_pData) {
    //Buscador de genero
    $ddlCancion =
        $("#ddlCancion").select2({
            data: obj_pData,
            language: "es",
            multiple: false,
            width: '85%',
            allowClear: true,
            minimumInputLength: 3,
            placeholder: "Ingrese la cancion",
            escapeMarkup: function (markup) { return markup; },

            ajax: {
                url: "AprobarSolicitud.aspx/ListarCancion",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                delay: 250,
                type: "POST",
                data: function (params) {
                    return JSON.stringify({
                        str_pDescripcion: (params.term || '').trim(),
                        int_pNumPagina: params.page || 1,
                        int_pTamPagina: 10
                    });
                },
                processResults: function (data, params) {
                    var lst_Results = [];
                    $.each(data.d.Result, function (i, v) {
                        var obj_Resultado = {};
                        obj_Resultado.id = v.IdCancion;
                        obj_Resultado.descripcion = v.Descripcion;
                        lst_Results.push(obj_Resultado);
                    })
                    params.page = params.page || 1;
                    return {
                        results: lst_Results,
                        pagination: {
                            more: (params.page * 10) < data.d.Total
                        }
                    };
                },
                cache: true
            },
            templateResult: function (option) {
                if (option.loading) { return option.text; }
                return $("<span>" + option.descripcion + "</span>");

            },
            templateSelection: function (option) {
                if (option.id == '') { return option.text; }
                return option.descripcion;
            }
        });
}
$("#ddlCancion").on('keyup', '.select2-search__field', function (e) {
    if (this.value.length < 3) {
        $('.select2-results__option').text('Ingrese mínimo 3 caracteres');
    }
});
function InicializarGeneroBuscador(obj_pData) {
    //Buscador de genero
    $ddlGenero =
        $("#ddlGenero").select2({
            data: obj_pData,
            language: 'es',
            multiple: false,
            width: '85%',
            allowClear: true,
            minimumInputLength: 3,
            placeholder: "Ingrese el genero",
            escapeMarkup: function (markup) { return markup; },
            ajax: {
                url: "RegistroCancion.aspx/ListarGenero",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                delay: 250,
                type: "POST",
                data: function (params) {
                    return JSON.stringify({
                        str_pDescripcion: (params.term || '').trim(),
                        int_pNumPagina: params.page || 1,
                        int_pTamPagina: 10
                    });
                },
                processResults: function (data, params) {
                    var lst_Results = [];
                    $.each(data.d.Result, function (i, v) {
                        var obj_Resultado = {};
                        obj_Resultado.id = v.IdGenero;
                        obj_Resultado.descripcion = v.Descripcion;
                        lst_Results.push(obj_Resultado);
                    })
                    params.page = params.page || 1;
                    return {
                        results: lst_Results,
                        pagination: {
                            more: (params.page * 10) < data.d.Total
                        }
                    };
                },
                cache: true
            },
            templateResult: function (option) {
                if (option.loading) { return option.text; }
                return $("<span>" + option.descripcion + "</span>");

            },
            templateSelection: function (option) {
                if (option.id == '') { return option.text; }
                return option.descripcion;
            }
        });
}

function InicializarIdiomaBuscador(obj_pData) {
    //Buscador de idioma
    $ddlIdioma =
        $("#ddlIdioma").select2({
            data: obj_pData,
            language: "es",
            multiple: false,
            width: '85%',
            allowClear: true,
            minimumInputLength: 3,
            placeholder: "Ingrese el idioma",
            escapeMarkup: function (markup) { return markup; },
            ajax: {
                url: "RegistroCancion.aspx/ListarIdioma",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                delay: 250,
                type: "POST",
                data: function (params) {
                    return JSON.stringify({
                        str_pDescripcion: (params.term || '').trim(),
                        int_pNumPagina: params.page || 1,
                        int_pTamPagina: 10
                    });
                },
                processResults: function (data, params) {
                    var lst_Results = [];
                    $.each(data.d.Result, function (i, v) {
                        var obj_Resultado = {};
                        obj_Resultado.id = v.IdIdioma;
                        obj_Resultado.descripcion = v.Descripcion;
                        lst_Results.push(obj_Resultado);
                    })
                    params.page = params.page || 1;
                    return {
                        results: lst_Results,
                        pagination: {
                            more: (params.page * 10) < data.d.Total
                        }
                    };
                },
                cache: true
            },
            templateResult: function (option) {
                if (option.loading) { return option.text; }
                return $("<span>" + option.descripcion + "</span>");

            },
            templateSelection: function (option) {
                if (option.id == '') { return option.text; }
                return option.descripcion;
            }
        });
}

function InicializarArtistaBuscador(obj_pData) {
    //Buscador de idioma
    $ddlArtista =
        $("#ddlArtista").select2({
            data: obj_pData,
            language: "es",
            multiple: false,
            width: '85%',
            allowClear: true,
            minimumInputLength: 3,
            placeholder: "Ingrese el artista",
            escapeMarkup: function (markup) { return markup; },
            ajax: {
                url: "RegistroCancion.aspx/ListarArtista",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                delay: 250,
                type: "POST",
                data: function (params) {
                    return JSON.stringify({
                        str_pDescripcion: (params.term || '').trim(),
                        int_pNumPagina: params.page || 1,
                        int_pTamPagina: 10
                    });
                },
                processResults: function (data, params) {
                    var lst_Results = [];
                    $.each(data.d.Result, function (i, v) {
                        var obj_Resultado = {};
                        obj_Resultado.id = v.IdArtista;
                        obj_Resultado.descripcion = v.Nombre;
                        lst_Results.push(obj_Resultado);
                    })
                    params.page = params.page || 1;
                    return {
                        results: lst_Results,
                        pagination: {
                            more: (params.page * 10) < data.d.Total
                        }
                    };
                },
                cache: true
            },
            templateResult: function (option) {
                if (option.loading) { return option.text; }
                return $("<span>" + option.descripcion + "</span>");

            },
            templateSelection: function (option) {
                if (option.id == '') { return option.text; }
                return option.descripcion;
            }
        });
}

function InicializarAlbumBuscador(obj_pData) {
    //Buscador de idioma
    $ddlAlbum =
        $("#ddlAlbum").select2({
            data: obj_pData,
            language: "es",
            multiple: false,
            width: '85%',
            allowClear: true,
            minimumInputLength: 3,
            placeholder: "Ingrese el album",
            escapeMarkup: function (markup) { return markup; },
            ajax: {
                url: "RegistroCancion.aspx/ListarAlbum",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                delay: 250,
                type: "POST",
                data: function (params) {
                    return JSON.stringify({
                        str_pDescripcion: (params.term || '').trim(),
                        int_pNumPagina: params.page || 1,
                        int_pTamPagina: 10,
                        int_IdArtista: ($("#ddlArtista").val() == null ? -1 : $("#ddlArtista").val()),

                    });
                },
                processResults: function (data, params) {
                    var lst_Results = [];
                    $.each(data.d.Result, function (i, v) {
                        var obj_Resultado = {};
                        obj_Resultado.id = v.IdAlbum;
                        obj_Resultado.descripcion = v.Titulo;
                        lst_Results.push(obj_Resultado);
                    })
                    params.page = params.page || 1;
                    return {
                        results: lst_Results,
                        pagination: {
                            more: (params.page * 10) < data.d.Total
                        }
                    };
                },
                cache: true
            },
            templateResult: function (option) {
                if (option.loading) { return option.text; }
                return $("<span>" + option.descripcion + "</span>");

            },
            templateSelection: function (option) {
                if (option.id == '') { return option.text; }
                return option.descripcion;
            }
        });
    $('#ddlArtista').on('select2:select', function (evt) {
        $ddlAlbum.val(null).trigger("change");

    });
}
function InicializarArtistaAlbumBuscador(obj_pData) {
    //Buscador de idioma
    $ddlArtistaAlbum =
        $("#ddlArtistaAlbum").select2({
            data: obj_pData,
            language: "es",
            multiple: false,
            width: '85%',
            allowClear: true,
            minimumInputLength: 0,
            placeholder: "Ingrese el artista",
            escapeMarkup: function (markup) { return markup; },
            ajax: {
                url: "RegistroCancion.aspx/ListarArtista",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                delay: 250,
                type: "POST",
                data: function (params) {
                    return JSON.stringify({
                        str_pDescripcion: (params.term || '').trim(),
                        int_pNumPagina: params.page || 1,
                        int_pTamPagina: 10
                    });
                },
                processResults: function (data, params) {
                    var lst_Results = [];
                    $.each(data.d.Result, function (i, v) {
                        var obj_Resultado = {};
                        obj_Resultado.id = v.IdArtista;
                        obj_Resultado.descripcion = v.Nombre;
                        lst_Results.push(obj_Resultado);
                    })
                    params.page = params.page || 1;
                    return {
                        results: lst_Results,
                        pagination: {
                            more: (params.page * 10) < data.d.Total
                        }
                    };
                },
                cache: true
            },
            templateResult: function (option) {
                if (option.loading) { return option.text; }
                return $("<span>" + option.descripcion + "</span>");

            },
            templateSelection: function (option) {
                if (option.id == '') { return option.text; }
                return option.descripcion;
            }
        });
}

function ValidacionCancionSimple() {
    var settings = $('#frmContent').validate().settings;
    $('.form-group').removeClass('has-error').removeClass('has-success');
    $.extend(settings, {
        ignore: "",
        rules: {
            ctl00$cphBody$txtDescripcionCancion: { CancionSimple: true }
        },
        messages: {
        },
    });
}
function ValidacionGenero() {
    var settings = $('#frmContent').validate().settings;
    $('.form-group').removeClass('has-error').removeClass('has-success');
    $.extend(settings, {
        ignore: "",
        rules: {
            ctl00$cphBody$txtDescripcionGenero: { Genero: true }
        },
        messages: {
        },
    });
}
function ValidacionIdioma() {
    var settings = $('#frmContent').validate().settings;
    $('.form-group').removeClass('has-error').removeClass('has-success');
    $.extend(settings, {
        ignore: "",
        rules: {
            ctl00$cphBody$txtDescripcionIdioma: { Idioma: true }
        },
        messages: {
        },
    });
}
function ValidacionArtista() {
    var settings = $('#frmContent').validate().settings;
    $('.form-group').removeClass('has-error').removeClass('has-success');
    $.extend(settings, {
        ignore: "",
        rules: {
            ctl00$cphBody$txtDescripcionArtista: { Artista: true }
        },
        messages: {
        },
    });
}
function ValidacionAlbum() {
    var settings = $('#frmContent').validate().settings;
    $('.form-group').removeClass('has-error').removeClass('has-success');
    $.extend(settings, {
        ignore: "",
        rules: {
            ctl00$cphBody$txtDescripcionAlbum: { Album: true },
            ddlArtistaAlbum: { selectAlbumModal: true }
        },
        messages: {
        },
    });
}
//---------------------AGREGAR------------------
function GuardarCancionSimple() {
    ValidacionCancionSimple();
    if ($('#frmContent').valid()) {
        var str_Descripcion = $("#txtDescripcionCancion").val();
        AccionDefault(true, "AprobarSolicitud.aspx/AgregarCancion", { "str_pDescripcion": str_Descripcion },
            function (obj_pResultado) {
                var lst_Centro = [];
                var obj_Centro = new Object();
                obj_Centro.id = obj_pResultado.ReturnId;
                obj_Centro.descripcion = str_Descripcion;
                lst_Centro.push(obj_Centro);

                $("#ddlCancion").select2('destroy');
                InicializarCancionBuscador(lst_Centro);
                $ddlCancion.val(obj_Centro.id).trigger('change');
                $("#mdCancion").modal('hide');
            }
            , null, null, null, 0);
    }
    return false;
}
function GuardarGenero() {
    ValidacionGenero();
    if ($('#frmContent').valid()) {
        var str_Descripcion = $("#txtDescripcionGenero").val();
        AccionDefault(true, "RegistroCancion.aspx/AgregarGenero", { "str_pDescripcion": str_Descripcion },
            function (obj_pResultado) {
                var lst_Centro = [];
                var obj_Centro = new Object();
                obj_Centro.id = obj_pResultado.ReturnId;
                obj_Centro.descripcion = str_Descripcion;
                lst_Centro.push(obj_Centro);

                $("#ddlGenero").select2('destroy');
                InicializarGeneroBuscador(lst_Centro);
                $ddlGenero.val(obj_Centro.id).trigger('change');
                $("#mdGenero").modal('hide');
            }
            , null, null, null, 0);
    }
    return false;
}
function GuardarIdioma() {
    ValidacionIdioma();
    if ($('#frmContent').valid()) {
        var str_Descripcion = $("#txtDescripcionIdioma").val();
        AccionDefault(true, "RegistroCancion.aspx/AgregarIdioma", { "str_pDescripcion": str_Descripcion },
            function (obj_pResultado) {
                var lst_Centro = [];
                var obj_Centro = new Object();
                obj_Centro.id = obj_pResultado.ReturnId;
                obj_Centro.descripcion = str_Descripcion;
                lst_Centro.push(obj_Centro);

                $("#ddlIdioma").select2('destroy');
                InicializarIdiomaBuscador(lst_Centro);
                $ddlIdioma.val(obj_Centro.id).trigger('change');
                $("#mdIdioma").modal('hide');
            }
            , null, null, null, 0);
    }
    return false;
}
function GuardarArtista() {
    ValidacionArtista();
    if ($('#frmContent').valid()) {
        var str_Descripcion = $("#txtDescripcionArtista").val();
        AccionDefault(true, "RegistroCancion.aspx/AgregarArtista", { "str_pDescripcion": str_Descripcion },
            function (obj_pResultado) {
                var lst_Centro = [];
                var obj_Centro = new Object();
                obj_Centro.id = obj_pResultado.ReturnId;
                obj_Centro.descripcion = str_Descripcion;
                lst_Centro.push(obj_Centro);

                $("#ddlArtista").select2('destroy');
                InicializarArtistaBuscador(lst_Centro);
                $ddlArtista.val(obj_Centro.id).trigger('change');
                $("#mdArtista").modal('hide');
            }
            , null, null, null, 0);
    }
    return false;
}

function GuardarAlbum() {
    ValidacionAlbum();
    if ($('#frmContent').valid()) {
        var str_Descripcion = $("#txtDescripcionArtistaAlbum").val();
        var int_Artista = $("#ddlArtista").val();

        AccionDefault(true, "RegistroCancion.aspx/AgregarAlbum", {
            "str_pDescripcion": str_Descripcion,
            "int_pIdArtista": int_Artista
        },
            function (obj_pResultado) {
                var lst_Centro = [];
                var obj_Centro = new Object();
                obj_Centro.id = obj_pResultado.ReturnId;
                obj_Centro.descripcion = str_Descripcion;
                obj_Centro.idartista = int_Artista;
                lst_Centro.push(obj_Centro);

                $("#ddlAlbum").select2('destroy');
                InicializarAlbumBuscador(lst_Centro);
                $ddlAlbum.val(obj_Centro.id).trigger('change');
                $("#mdAlbum").modal('hide');
            }
            , null, null, null, 0);
    }
    return false;
}